# Skill Builder Pipeline - Orchestrator Config

## Pipeline Overview
```yaml
pipeline_id: skill-development-pipeline
version: 1.0.0
description: End-to-end skill foundation generation and refinement
trigger: manual | api | scheduled

agents:
  - skill-builder-v1      # Foundation generator (this prompt)
  - skill-refiner         # Expands refinement vectors
  - curriculum-builder    # Creates learning path
  - exercise-generator    # Builds practice materials
  - assessment-creator    # Generates tests/rubrics
```

---

## Agent Orchestration Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                         USER INPUT                               │
│              topic + depth + optional context                    │
└─────────────────────────┬───────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                    SKILL-BUILDER-V1                              │
│                  (Foundation Generator)                          │
│                                                                  │
│  Outputs: mental_model, building_blocks, competency_tiers,      │
│           first_win, refinement_vectors, handoff                │
└─────────────────────────┬───────────────────────────────────────┘
                          │
              ┌───────────┼───────────┬───────────┐
              │           │           │           │
              ▼           ▼           ▼           ▼
┌─────────────────┐ ┌───────────┐ ┌─────────┐ ┌──────────┐
│  SKILL-REFINER  │ │ CURRICULUM│ │EXERCISE │ │ASSESSMENT│
│                 │ │  BUILDER  │ │GENERATOR│ │ CREATOR  │
│ Expands vectors │ │           │ │         │ │          │
│ into sub-skills │ │ Learning  │ │Practice │ │ Rubrics  │
└────────┬────────┘ │   Path    │ │Materials│ │ & Tests  │
         │          └─────┬─────┘ └────┬────┘ └────┬─────┘
         │                │            │           │
         └────────────────┴────────────┴───────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                      AGGREGATOR                                  │
│           Combines all outputs into final package               │
└─────────────────────────────────────────────────────────────────┘
```

---

## Orchestrator Implementation

### Option A: Sequential (Simple)
```python
# claude_flow_skill_pipeline.py

from claude_flow import Pipeline, Agent

pipeline = Pipeline("skill-development")

@pipeline.stage(1)
async def build_foundation(topic: str, depth: str = "basic"):
    """Generate skill foundation - MUST complete before downstream"""
    agent = Agent.load("skill-builder-v1")
    return await agent.run({
        "topic": topic,
        "depth": depth,
        "output_format": "json"
    })

@pipeline.stage(2, depends_on=["build_foundation"])
async def refine_vectors(foundation: dict):
    """Expand each refinement vector into sub-foundations"""
    agent = Agent.load("skill-refiner")
    vectors = foundation["foundation"]["refinement_vectors"]
    
    results = []
    for vector in vectors:
        result = await agent.run({
            "vector": vector,
            "parent_foundation": foundation,
            "depth": "intermediate"
        })
        results.append(result)
    
    return results

@pipeline.stage(2, depends_on=["build_foundation"])  # Parallel with refiner
async def build_curriculum(foundation: dict):
    """Generate learning path from foundation"""
    agent = Agent.load("curriculum-builder")
    return await agent.run({
        "foundation": foundation,
        "format": "progressive",
        "include_time_estimates": True
    })

@pipeline.stage(2, depends_on=["build_foundation"])  # Parallel
async def generate_exercises(foundation: dict):
    """Create practice materials for each building block"""
    agent = Agent.load("exercise-generator")
    return await agent.run({
        "building_blocks": foundation["foundation"]["building_blocks"],
        "first_win": foundation["foundation"]["first_win"],
        "exercise_count_per_block": 3
    })

@pipeline.stage(3, depends_on=["build_curriculum", "generate_exercises"])
async def create_assessments(curriculum: dict, exercises: list):
    """Build assessments aligned with curriculum"""
    agent = Agent.load("assessment-creator")
    return await agent.run({
        "curriculum": curriculum,
        "exercises": exercises,
        "assessment_types": ["quiz", "project", "self-check"]
    })

@pipeline.aggregate
async def package_results(foundation, refined, curriculum, exercises, assessments):
    """Combine all outputs into deliverable package"""
    return {
        "skill_package": {
            "foundation": foundation,
            "extended_skills": refined,
            "learning_path": curriculum,
            "practice_materials": exercises,
            "assessments": assessments
        },
        "meta": {
            "generated_at": datetime.now().isoformat(),
            "total_agents_used": 5,
            "ready_for_delivery": True
        }
    }
```

### Option B: Hive Mind (Parallel Execution)
```yaml
# hive_config.yaml

hive:
  name: skill-builder-hive
  coordinator: claude-opus  # or claude-sonnet for cost savings
  workers: 4
  
tasks:
  - id: foundation
    agent: skill-builder-v1
    priority: critical
    timeout: 120s
    
  - id: refinement
    agent: skill-refiner
    depends_on: [foundation]
    parallel: true  # Run all vectors simultaneously
    worker_count: 3
    
  - id: curriculum
    agent: curriculum-builder
    depends_on: [foundation]
    
  - id: exercises
    agent: exercise-generator
    depends_on: [foundation]
    
  - id: assessment
    agent: assessment-creator
    depends_on: [curriculum, exercises]

aggregation:
  strategy: merge_deep
  output_format: json
  save_to: ./output/skill_package.json
```

---

## State Management

```yaml
state_schema:
  input:
    topic: string
    depth: enum[basic, intermediate, advanced]
    context: string | null
    
  shared:
    foundation: SkillFoundation | null
    building_block_map: dict  # BB-ID -> full block
    current_stage: string
    errors: list
    
  output:
    skill_package: SkillPackage
    generation_log: list
    quality_score: float
```

---

## Error Recovery

```yaml
error_handling:
  on_agent_failure:
    - retry: 2
    - fallback_agent: skill-builder-v1-lite  # Simpler version
    - escalate_to_human: true
    
  on_timeout:
    - save_partial_state: true
    - notify: webhook
    
  on_schema_mismatch:
    - log_error: true
    - attempt_coercion: true
    - fail_gracefully: true

recovery_checkpoints:
  - after: foundation
  - after: refinement
  # Allows resume from last successful stage
```

---

## CLI Invocation

```bash
# Single topic
claude-flow run skill-development --topic "API design" --depth basic

# Batch processing
claude-flow run skill-development --batch topics.json --parallel 3

# With context
claude-flow run skill-development \
  --topic "Python testing" \
  --depth intermediate \
  --context "Focus on pytest, for data scientists"

# Resume failed run
claude-flow resume skill-development --checkpoint ./checkpoints/abc123
```

---

## Integration Points

### Webhook Output
```json
{
  "event": "pipeline_complete",
  "pipeline_id": "skill-development-pipeline",
  "run_id": "uuid",
  "topic": "Git version control",
  "outputs": {
    "foundation_url": "s3://bucket/foundations/git.json",
    "curriculum_url": "s3://bucket/curricula/git.json",
    "full_package_url": "s3://bucket/packages/git-complete.json"
  },
  "metrics": {
    "total_time_seconds": 45,
    "tokens_used": 12500,
    "agents_invoked": 5
  }
}
```

### API Trigger
```bash
curl -X POST https://your-api/skill-pipeline \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "topic": "Kubernetes basics",
    "depth": "basic",
    "webhook": "https://your-site/webhooks/skill-complete"
  }'
```
